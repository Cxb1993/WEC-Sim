.. _theory:

Theory
======
The section provides an overview of the underlying theory behind the WEC-Sim code.

Introduction
--------------
Modeling a wave energy converter (WEC) involves the interaction between the incident waves, device motion, power-take-off (PTO mechanism), and mooring. WEC-Sim uses a radiation and diffraction method :cite:`Li2012,Babarit2012` to predict power performance and design optimization. The radiation and diffraction method generally obtains the hydrodynamic forces from a frequency-domain boundary element method (BEM) solver using linear coefficients to solve the system dynamics in the time domain.

.. _wec_sim_methodology:

.. figure:: _static/Physics.png
    :align: center
    
    ..
    
    *WEC-Sim Methodology*


Coordinate System
------------------------------
The :ref:`coordinate_system` figure illustrates a 3-D floating point absorber subject to incoming waves in water. The figure also defines the coordinates and the 6 degree of freedom (DOF) in WEC-Sim. The WEC-Sim coordinate system  assumes that the positive X-axis defines a wave angle heading of zero (e.g., a wave propagating with along a zero-degree heading is moving in the +X direction). The Z-axis is in the vertical upwards direction, and the Y-axis direction is defined by the right-hand rule. In the vectors and matrices used in the code, Surge (x), Sway (y), and Heave (z) correspond to the first, second and third position respectively. Roll (Rx), Pitch (Ry), and Yaw (Rz) correspond to the fourth, fifth, and sixth position respectively.

.. _coordinate_system:

.. figure:: _static/coordinateSystem.png
    :align: center
    
    ..

    *WEC-Sim Coordinate System*


Time-Domain Numerical Method
------------------------------------
A common approach to determining the hydrodynamic forces is to use the linear wave theory assumption that waves are the sum of incident, radiated, and diffracted wave components. The dynamic response of the system is calculated by solving the equation of motion for WEC systems :cite:`Babarit2012,Nolte2014`. The equation of motion for a floating body about its center of gravity can be given as:

.. math::

	m\ddot{X}=F_{ext}+F_{rad}+F_{PTO}+F_{v}+F_{ME}+F_{B}+F_{m}


where :math:`\ddot{X}` is the (translational and rotational) acceleration vector of the device, :math:`m` is the mass matrix, :math:`F_{ext}` is the wave excitation force (6-element) vector, :math:`F_{rad}` is the force vector resulting from wave radiation, :math:`F_{PTO}` is the PTO force vector, :math:`F_{v}` is the damping force vector, :math:`F_{ME}` is the Morison Element Force vector, :math:`F_{B}` is the net buoyancy restoring force vector, and :math:`F_{m}` is the force vector resulting from the mooring connection.

Both :math:`F_{ext}` and :math:`F_{rad}` are calculated from values provided by the frequency-domain BEM solver. The radiation term includes an added-mass term, matrix :math:`A(\omega)`, and wave damping term, matrix :math:`B(\omega)`, associated with the acceleration and velocity of the floating body, respectively, and given as functions of radian frequency (:math:`\omega`)by the BEM solver. The wave excitation term :math:`F_{X}(\omega)` includes a Froude-Krylov force component generated by the undisturbed incident waves and a diffraction component that results from the presence of the floating body. 


Boundary Element Method
----------------------------------
In WEC-Sim, wave forcing components are modeled using linear coefficients  obtained from a frequency-domain potential flow BEM solver (e.g., WAMIT :cite:`Lee2006`, AQWA-FER :cite:`AQWA`, and Nemoh :cite:`NEMOH`). The BEM solutions are obtained by solving the Laplace equation for the velocity potential, which assumes the flow is inviscid, incompressible, and irrotational. More details on the theory for the frequency-domain BEM can be found in :cite:`Lee2006`.

WEC-Sim imports non-dimensionalized hydrodynamic coefficients from an ``*.h5``  data structure generated by `BEMIO  <http://wec-sim.github.io/bemio/>`_ for the WAMIT, AQWA or Nemoh BEM solvers. Alternatively, the ``*.h5`` data structure can be manually defined by the user. The WEC-Sim code then scales the hydrodynamic coefficients according to the scaling defined below, where :math:`\rho` is the water density, :math:`\omega` is the wave frequency in rad/s, and g is gravity:

.. math::

	|\overline{F_{X}(\omega)}|=\frac{|F_{X}(\omega)|}{\rho g}
	
	\overline{A(\omega)} = \frac{A(\omega)}{\rho}
	
	\overline{B(\omega)} = \frac{B(\omega)}{\rho \omega}
	
	\overline{W} = \frac{W}{\rho g}

Here, :math:`W` refers to the hydrostatic stiffness related to the buoyancy restoring force.

Solver Methods
---------------------------------------------

WEC-Sim can be used for regular and irregular wave simulations, but note that :math:`F_{ext}` and :math:`F_{rad}` are calculated differently for sinusoidal steady-state response scenarios and random sea simulations. The sinusoidal steady-state response is often used for simple WEC designs with regular incoming waves. However, for random sea simulations or any simulations where fluid memory effects of the system are essential, the convolution integral method is recommended to represent the fluid memory retardation force on the floating body. To speed computation of the convolution integral, the state space representation method can be specified to approximate this calculation as a system of linear ordinary differential equations. 

Ramp Function
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A ramp function (:math:`R_{f}`), necessary to avoid strong transient flows at the earlier time steps of the simulation, is used to calculate the wave excitation force. The ramp function is given by

.. math::

	R_{f}=\begin{cases}
	\frac{1}{2}(1+\cos(\pi+\frac{\pi t}{t_{r}}) & \frac{t}{t_{r}}<1\\
	1 & \frac{t}{t_{r}}\geq1
	\end{cases}

where :math:`t` is the simulation time and :math:`t_{r}` is the ramp time.

Sinusoidal Steady-State Response Scenario
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This approach assumes that the system response is in sinusoidal steady-state form; therefore, it is only valid for regular wave simulations. The radiation term can be calculated using the added mass and the wave radiation damping term for a given wave frequency, which is obtained from

.. math::

	F_{rad}=-A(\omega)\ddot{X}-B(\omega)\dot{X}

where :math:`\dot{X}` is the velocity vector of the floating body.

The free surface profile is based on linear wave theory for a given wave height, wave frequency, and water depth. The regular wave excitation force is obtained from

.. math::

	F_{ext}=\Re\left[ R_{f}\frac{H}{2}F_{X}(\omega)e^{i(\omega t)} \right]


where :math:`\Re` denotes the real part of the formula, :math:`R_{f}` is the ramp function, :math:`H` is the wave height, and :math:`F_{X}` is the excitation vector, including the magnitude and phase of the force.

Convolution Integral Formulation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
To include the fluid memory effect on the system the convolution integral formulation based upon the Cummins equation :cite:`Cummins1962` is used. The radiation term can be calculated by

.. math::

	F_{rad}=-A_{\infty}\ddot{X}-\intop_{0}^{t}K_{r}(t-\tau)\dot{X}(\tau)d\tau

where :math:`A_{\infty}` is the added mass matrix at infinite frequency and :math:`K_{r}` is the radiation impulse response function.

For regular waves, the equation described in the last subsection is used to calculate the wave excitation force. For irregular waves, the free surface elevation is constructed from a linear superposition of a number of regular wave components. Each regular wave component is extracted from a wave spectrum, :math:`S(\omega)`, describing the wave energy distribution over a range,of wave frequencies, characterized by a significant wave height and peak wave period. The irregular excitation force can be calculated as the real part of an integral term across all wave frequencies as follows 

.. math::

	F_{ext}=\Re\left[ R_{f} \intop_{0}^{\infty}F_{X}(\omega_{r})e^{i(\omega_{r}t+\phi)} \sqrt{2S(\omega_{r})}d\omega_{r} \right]

where :math:`\phi` is a random phase angle. For repeatable simulation of an irregular wave field :math:`S(\omega)`, WEC-Sim allows specification of :math:`\phi`. 

.. figure:: _static/WaveElevation.png
     :align: center
    
     ..

     *Example irregular wave elevation :math:`\eta`  generated by WEC-Sim*

State Space Representation of :math:`K_{r}`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It is highly desirable to represent the radiation convolution integral discribed in the last subsection in state space (SS) form :cite:`Yu1996`.  This has been shown to dramatically increase computational speeds :cite:`Taghipour2008` and allow utilization of conventional control methods that rely on linear state space models.  An approximation will need to be made as :math:`K_{r}` is solved from a set of partial differential equations where as a `linear state space` is constructed from a set of ordinary differential equations.  In general, a linear system is desired such that:

.. math::

	\dot{X}_{r} \left( t \right) = \mathbf{A_{r}} X_{r} \left( t \right) + \mathbf{B_{r}} \mathbf{\dot{\zeta}} (t);~~X_{r}\left( 0 \right) = 0~~ \nonumber \\
	\int_{-\infty}^{t} \mathbf{K_{r}} \left( t- \tau \right) d\tau \approx \mathbf{C_{r}} X_{r} \left( t \right) + \mathbf{D_{r}} \mathbf{\dot{\zeta}} \left( t \right)~~

with :math:`\mathbf{A_{r}},~\mathbf{B_{r}},~\mathbf{C_{r}},~\mathbf{D_{r}}` being the time-invariant state, input, output, and feed through matrices, while :math:`\dot{\zeta}` is the input to the system and :math:`X_{r}` is the state vector describing the convolution kernal as time progresses.

Calculation of :math:`K_{r}` from State Space Matrices
......................................................

The impulse response of a single-input zero-state state-space model is represented by

.. math::

	\dot{x_{r}} &=&  \mathbf{A_{r}}x_{r} + \mathbf{B_{r}} u~~\\
	y &=& \mathbf{C_{r}}x_{r}~~

where :math:`u` is an impulse. If the initial state is set to :math:`x(0)= \mathbf{B_{r}} u` the response of the unforced (:math:`u=0`) system

.. math::

	\dot{x} &=& \mathbf{A_{r}} x~~,\\
	y &=& \mathbf{C_{r}} x~~

is clearly equivalent to the zero-state impulse reponse. The impulse response of a continuous system with a nonzero :math:`\mathbf{D_r}` matrix is infinite at :math:`t=0`; therefore, the lower continuity value :math:`\mathbf{C_{r}}\mathbf{B_{r}}` is reported at :math:`t=0`. The general solution to a linear time invariant (LTI) system is given by:

.. math::

	x(t) = e^{\mathbf{A_{r}}t} x(0) + \int_{0}^{t} e^{\mathbf{A_{r}}(t-\tau)} \mathbf{B_{r}} u (\tau) d\tau~~

where :math:`e^{\mathbf{A_{r}}}` is the matrix exponential and the calculation of :math:`K_{r}` follows:

.. math::

	K_{r}(t) = \mathbf{C_{r}}e^{\mathbf{A_{r}}t}\mathbf{B_{r}}~~

Realization Theory
......................................................
The state space realization of the hydrodynamic radiation coefficients can be pursued in the time domain (TD). This consists of finding the minimal order of the system and the discrete time state matrices (:math:`\mathbf{A_{d}},~\mathbf{B_{d}},~\mathbf{C_{d}},~\mathbf{D_{d}}`) from samples of the impulse response function.  This problem is easier to handle for a discrete-time system than for continuous-time. The reason being is that the impulse response function of a discrete-time system is given by the Markov parameters of the system:

.. math::

	\mathbf{\tilde{K}_{r}} \left( t_{k} \right) = \mathbf{C_{d}}\mathbf{A_{d}}^{k}\mathbf{B_{d}}~~

where :math:`t_{k}=k\Delta t` for :math:`k=0,~1,~2,~\ldots` with :math:`\Delta t` being the sampling period.  The feedthrough matrix :math:`\mathbf{D_d}` is assumed to be zero in order to maintain causality of the system, as a non-zero `\mathbf{D_d}` results in an infinite value at :math:`t=0`.

The most common algorithm to obtain the realization is to perform a Singular Value Decomposition (SVD) on the Hankel matrix of the impulse response function, as proposed by Kung :cite:`Kung1978`.  The order of the system and state-space parameters are determined from the number of significant singular values and the factors of the SVD.  The Hankel matrix (:math:`H`) of the impulse response function

.. math::

	& H = \begin{bmatrix}
    		\mathbf{K_{r}}(2) & \mathbf{K_{r}}(3) & \ldots & \mathbf{K_{r}}(n) \\
       		\mathbf{K_{r}}(3) & \mathbf{K_{r}}(4) & \ldots & 0 \\
       		\vdots & \vdots & \ddots & \vdots \\
       		\mathbf{K_{r}}(n) & 0 & \cdots & 0
      	\end{bmatrix} &\\ 

can be reproduced exactly by the SVD as

.. math::

	H = \mathbf{U} \Sigma \mathbf{V^{*}}


where :math:`\Sigma` is a diagonal matrix containing the Hankel singular vales in descending order.  Examination of the Hankel singular values reveals there are only a small number of significant states and that the rank of :math:`H` can be greatly reduced without a significant loss in accuracy :cite:`Taghipour2008,Kristiansen2005`. Further detail into the SVD method and calculation of the state space parameters will not be discussed and the reader is referred to :cite:`Taghipour2008,Kristiansen2005`.

Wave Spectrum
--------------------------------------------
The ability to generate regular waves provides an opportunity to observe the response of a model under specific conditions. Sea states with constant wave heights and periods are rarely found outside wave tank test. Normal sea conditions are more accurately represented by random-wave time series that model the superposition of various wave forms with different amplitudes and periods. This superposition of waves is characterized by a sea spectrum. Through statistical analysis, spectra are characterized by specific parameters such as significant wave height, peak period, wind speed, fetch length, and others. The common types of spectra that are used by the offshore industry are discussed in the following sections.  The general form of the sea spectrums available in WEC-Sim is given by:

.. math::

	S\left( f \right) = A f^{-5}\exp\left[-B f^{-4} \right]~~

where :math:`f` is the wave frequency (in Hertz) and :math:`\exp` stands for the exponential function.

Pierson--Moskowitz
...............................
One of the simplest spectra was proposed by :cite:`PM`. It assumed that after the wind blew steadily for a long time over a large area, the waves would come into equilibrium with the wind. This is the concept of a fully developed sea where a "long time" is roughly 10,000 wave periods and a "large area" is roughly 5,000 wave-lengths on a side.  The spectrum is calculated from

.. math::
	& S\left( f \right) = \frac{\alpha_{PM}g^{2}}{\left( 2 \pi \right)^{4}}f^{-5}\exp\left[-\frac{5}{4} \left( \frac{f_{p}}{f}\right)^{4} \right]~~ &\\

	& A = \frac{\alpha_{PM}g^{2}}{\left( 2 \pi \right)^{4}},~~B = \frac{5}{4} {f_{p}}^{4}~~ &

where :math:`\alpha_{PM}` = 0.0081, :math:`g` is gravity and :math:`f_{p}` is the peak frequency of the spectrum. However, this spectrum representation does not allow the user to define the significant wave height. To facilitate the creation of a power matrix in WEC-Sim, the :math:`\alpha_{PM}` coefficient was calculated such that the desired significant wave height of the sea state was met.  The :math:`\alpha_{PM}` fit was calculated as follows:

.. math::
	\alpha_{PM} = \frac{H_{m0}^{2}}{16\int_{0}^{\infty} S^{*} \left( f \right) df}~~
	
	S^{*}\left( f \right) = \frac{ g^{2} }{ (2\pi)^{4}} f^{-5}\exp\left[-\frac{5}{4} \left( \frac{f_{p}}{f}\right)^{4} \right]~~


Note that related to the spectrum is a series of characteristic numbers called the spectral moments. These numbers, denoted :math:`m_{k}~,~k=0, 1, 2,...` are defined as

.. math::
	m_{k} = \int_{0}^{\infty} f^{k} S \left( f \right) df ~~

The spectral moment, :math:`m_{0}` is the variance of the free surface which allows one to define

.. math::
	H_{m0} = 4 \sqrt{m_{0}}~~

Bretschneider Spectrum
................................
This two-parameter spectrum is based on significant wave height and peak wave frequency.  For a given significant wave height, the peak frequency can be varied to cover a range of conditions including developing and decaying seas. In general, the parameters depend on wind speed (most important), wind direction, fetch, and locations of storm fronts. The spectrum is given as

.. math::
	& S\left( f \right) = \frac{{H_{m0}}^2}{4}\left(1.057f_{p}\right)^{4}f^{-5}\exp\left[-\frac{5}{4} \left( \frac{f_{p}}{f}\right)^{4} \right]~~ &\\
	
	& A =\frac{{H_{m0}}^2}{4}\left(1.057f_{p}\right)^{4} \approx \frac{5}{16} {H_{m0}}^2 {f_{p}}^{4}~~ &\\ 
	
	& B = \left(1.057f_{p}\right)^{4} \approx \frac{5}{4} {f_{p}}^{4}~~ &

where :math:`H_{m0}` is the significant wave height which is generally defined as the mean wave height of the one third highest waves.

JONSWAP (Joint North Sea Wave Project) Spectrum
....................................................

The spectrum was purposed by Hasselmann et al. :cite:`HK`, and the original formulation was given as

.. math::
	& S\left( f \right) = \frac{ \alpha_{j} g^{2} }{ (2\pi)^{4}} f^{-5}\exp\left[-\frac{5}{4} \left( \frac{f_{p}}{f}\right)^{4} \right]\gamma^\Gamma \nonumber & \\ 
	
	&\Gamma = \exp \left[ -\left( \frac{\frac{f}{f_{p}}-1}{\sqrt{2} \sigma}\right)^{2} \right],~~ \sigma = \begin{cases} 0.07 & f \leq f_{p} \\0.09 & f > f_{p} \end{cases} ~~ &\\
	
	& A =\frac{ \alpha_{j} g^{2} }{ (2\pi)^{4}},~~B = \frac{5}{4} {f_{p}}^{4}~~ &

where :math:`\alpha_{j}` is a nondimensional variable that is a function of the wind speed and fetch length. 

Empirical fits were applied in an attempt to find a mean value that would capture the spectral shape of most measured sea states. To fit :math:`\alpha_{j}` to match the desired significant wave height the following calculation must be performed

.. math::
	\alpha_{j} = \frac{H_{m0}^{2}}{16\int_{0}^{\infty} S^{*} \left( f \right) df}

	S^{*}\left( f \right) = \frac{ g^{2} }{ (2\pi)^{4}} f^{-5}\exp\left[-\frac{5}{4} \left( \frac{f_{p}}{f}\right)^{4} \right]\gamma^\Gamma ~~

**Spectrum purposed at ITTC**

Another form of JONSWAP spectrum was purposed at the 17th International Towing Tank Conference (ITTC). It was defined as

.. math::

	& S\left( f \right) = \frac{155 }{ \left( 2\pi \right)^{4}} \frac{H_{m0}^{2}}{(0.834T_{p})^{4}} f^{-5}\exp\left[-\frac{5}{4} \left( \frac{f_{p}}{f}\right)^{4} \right]\gamma^\Gamma \nonumber & \\ 

	& \approx \frac{310 }{ \left( 2\pi \right)^{4}} {H_{m0}}^{2} {f_{p}}^{4} f^{-5}\exp\left[-\frac{5}{4} \left( \frac{f_{p}}{f}\right)^{4} \right]\gamma^\Gamma~~ &\\

	&\Gamma = \exp \left[ -\left( \frac{\frac{f}{f_{p}}-1}{\sqrt{2} \sigma}\right)^{2} \right],~~ \sigma = \begin{cases} 0.07 & f \leq f_{p} \\ 0.09 & f > f_{p} \end{cases} ~~ \\

	& A =\frac{310 }{ \left( 2\pi \right)^{4}} {H_{m0}}^{2} {f_{p}}^{4},~~B = \frac{5}{4} {f_{p}}^{4}~~ &

The figure below shows the comparison of the JONSWAP spectrum obtained from the :math:`\alpha_{j}` fit and the ITTC description .  It is clear that the two methods have very good agreement.

.. figure:: _static/Jonswap.png
    :align: center
    
    ..
      
    *Comparison of* :math:`\alpha_{j}` *fit to the ITTC description of the JONSWAP spectrum with* :math:`H_{m0}` = 2m *and* :math:`T_{p}` = 8s


Power Take-off (PTO) Forces
---------------------------

Linear Spring-damper PTO
~~~~~~~~~~~~~~~~~~~~~~~~~~


The PTO mechanism is represented as a linear spring-damper system where the reaction force is given by: 

.. math::

	F_{PTO}=-K{}_{PTO}X_{rel}-C_{PTO}\dot{X}_{rel}

where :math:`K_{PTO}` is the stiffness of the PTO, :math:`C_{PTO}` is the damping of the PTO, and :math:`X_{rel}` and :math:`\dot{X}_{rel}` are the relative motion and velocity between two bodies.  

The power consumed by the PTO is given by:

 .. math::
	
	P_{PTO} = -F_{PTO}\dot{X}_{rel}=\left(K_{PTO}X_{rel}\dot{X}_{rel}+C_{PTO}\dot{X}^{2}_{rel}\right)


However, the relative motion and velocity between two bodies is out of phase by :math:`\pi/2`, resulting in a time-averaged product of 0. This allows the absorbed power to be written as

.. math::
	P_{PTO} =C_{PTO}\dot{X}^{2}_{rel}

Hydraulic PTO
~~~~~~~~~~~~~~~~

The PTO mechanism is modeled as a hydraulic system :cite:`So`, where the reaction force is given by:

.. math::

	F_{PTO}=\Delta{} p_{piston}A_{piston}

where :math:`\Delta{} p_{piston}` is the differential pressure of hydraulic piston and :math:`A_{piston}` is the piston area. 

The power absorbed by the PTO is given by:  

.. math::

	P_{PTO}=-F_{PTO}\dot{X}_{rel}


Mechanical PTO
~~~~~~~~~~~~~~~~

The PTO mechanism is modeled as a direct drive linear generator system :cite:`So`, where the reaction force is given by:

.. math::

	F_{PTO}=(\frac{\pi}{\tau_{pm}})\lambda_{fd}i_{sq}

where :math:`\tau_{pm}` is the magnet pole pitch (the distance measured of the magnet from the center of one pole to the center of the next pole), :math:`\lambda_{fd}` is the flux linkage of the stator :math:`d`-axis winding due to flux produced by the rotor magnets, and :math:`i_{sq}` is the stator :math:`q`-axis current. 

The power absorbed by the PTO is given by:  

.. math::

	P_{PTO}=-F_{PTO}\dot{X}_{rel}

Mooring Forces
-------------------------
The mooring load is represented using a linear quasi-static mooring stiffness or by using the mooring forces calculated from `MoorDyn <http://www.matt-hall.ca/moordyn>`_ :cite:`Hall2015MoorDynGuide`, which is an open-source lumped-mass mooring dynamics model. 

When linear quasi-static mooring stiffness is used, the mooring load can be calculated by

.. math::
	F_{m}=-K_{m}X-C_{m}\dot{X}

where :math:`K_{m}` and :math:`C_{m}` are the stiffness and damping matrices for the mooring system, and :math:`X` and :math:`\dot{X}` are the response and velocity of the body, respectively.

When coupling with MoorDyn, each mooring line in a mooring system is discretized into evenly-sized line segments connected by node points (as seen in the MoorDyn figure below). The line mass is lumped at these node points along with gravitational and buoyancy forces, hydrodynamic loads, and reactions from contact with the seabed.  Hydrodynamic drag and added mass are calculated based on Morison's equation.  A mooring line's axial stiffness is modeled by applying a linear stiffness to each line segment in tension only.  A damping term is also applied in each segment to dampen non-physical resonances caused by the lumped-mass discretization.  Bending and torsional stiffnesses are neglected.  Bottom contact is represented by vertical stiffness and damping forces when nodes pass below the seabed :cite:`Hall2015ValidationData`.  

.. _MoorDyn:

.. figure:: _static/MoorDyn_Graphic.png
   :scale: 70 %
   :align: center
    
   ..

   *MoorDyn mooring model elements*


Additional Added-mass & Damping Forces
----------------------------------------
To account for additional drag contributions and calibrate numerical models compared to experiments rather than inertial forces that arise because of mass properties, additional added-mass and damping forces can be included by adding linear and quadratic damping terms and by using Morison Equation.  

Linear & Quadratic Damping Forces
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The effect of damping to the system is included by specifying linear and quadratic damping terms to the equation of motion,

 .. math::
	F_{v}=-C_{ld}\dot{X}-\frac{1}{2}C_{d}\rho A_{D}\dot{X}|\dot{X}|

where :math:`C_{ld}` is the linear damping coefficient, :math:`C_{d}` is the (quadratic) viscous drag coefficient, :math:`\rho` is the fluid density, and :math:`A_{D}` is the characteristic area.

Generally, the effect of viscosity on the WEC dynamics needs to be considered as neglecting this effect may lead to an overestimation of the power generation of the system, particularly when a linear model is applied. A common way of modeling the viscous damping is to add an quadratic damping term to the equation of motion. The viscous drag coefficient for the device must be carefully selected :cite:`Li2012,Babarit2012`; however, it is dependent on device geometry, scale, and relative velocity between the body and the flow around it. The drag coefficient becomes much larger when the Reynolds and the Keulegan-Carpenter number are smaller. Note that empirical data on the drag coefficient can be found in various literature and standards. The available data may, however, be limited to existing simple geometries. For practical point absorber geometry, the hydrodynamic forces may have to be evaluated by conducting wave tank tests or prescribed motion computational fluid dynamic simulations.

Morison Elements 
~~~~~~~~~~~~~~~~
The Morison Equation assumes that the fluid forces in an oscillating flow on a structure of slender cylinders or other similar geometries arise partly from pressure effects from potential flow and partly from viscous effects. A slender cylinder implies that the diameter, D, is small relative to the wave length, :math:`λ_w`, which is generally met when :math:`D/λ_w < 0.1 − 0.2`. If this condition is not met, wave diffraction effects must be taken into account. Assuming that the geometries are slender, the resulting force can be approximated by a modified Morison formulation :cite:`Morison1950`. The formulation for each element on the body can be given as

 .. math::
	F_{ME}=\rho∀\dot{v}+\rho\forall C_{a}(\dot{v}-\ddot{X})+\frac{1}{2}C_{d}\rho A_{D}(v-\dot{X})|v-\dot{X}|

where :math:`v` is the fluid particle velocity, and :math:`\forall` is the displaced volume. 

Note that WEC-Sim currently does not consider buoyancy effects when calculating the forces from Morison elements. 

Nonlinear Hydrodynamic Forces
------------------------------
The linear model assumes that the body motion and the waves consist of small amplitudes in comparison to the wavelengths. A weakly nonlinear approach is applied to account for the nonlinear hydrodynamic forces induced by the instantaneous water surface elevation and body position. Rather than the BEM calculated linear hydrodynamic force coefficients, the nonlinear buoyancy and the Froude-Krylov force components can be obtained by integrating the static and dynamic pressures over each panel along the wetted body surface at each time step. 
Because linear wave theory is used to determine the flow velocity and pressure field, the values become unrealistically large for wetted panel that are above the mean water level. To correct this, the Wheeler stretching method :cite:`wheeler1969methods` ,which forces the water column (based on the instantaneous wave elevation) to have a height that equals to the water depth when calculating the flow velocity and pressure, is used.

 .. math::
	z^* = \frac{D(D+z)}{(D+\eta)} - D

where :math:`D` is the mean water depth, and :math:`\eta` is the z-value on the instantaneous water surface.

Note that the nonlinear WEC-Sim method is not intended to model highly nonlinear hydrodynamic events, such as wave slamming and wave breaking. 


References
--------------
.. bibliography:: WEC-Sim_Theory.bib
   :style: unsrt
